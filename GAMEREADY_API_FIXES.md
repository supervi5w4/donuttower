# Исправления GameReady API для соответствия требованиям Яндекс.Игры

## Проблемы, которые были исправлены

### 1. Музыка запускалась при клике по черному экрану
**Проблема**: `AudioUnlocker` обрабатывал ВСЕ события ввода, включая клики по неигровым областям.

**Решение**: 
- Добавлена функция `_is_click_on_game_area()` для проверки области клика
- Музыка разблокируется только при клике по игровой области (центр экрана 4:3, 80% высоты)

### 2. GameReady API вызывался слишком рано
**Проблема**: GameReady API вызывался при загрузке сцены игры, а не когда пользователь готов играть.

**Решение**:
- Перенесен вызов `YandexSDK.game_ready()` из `_initialize_yandex_sdk_async()` в `_start_game()`
- API вызывается только когда игра действительно начинается

### 3. Отсутствие обработки событий паузы/возобновления
**Проблема**: Не было обработки событий `game_api_pause` и `game_api_resume` (требование 1.19.4).

**Решение**:
- Добавлена функция `setupPauseResumeHandlers()` в JavaScript
- Добавлен метод `setup_pause_resume_handlers()` в GDScript
- Обработчики настраиваются при инициализации SDK

### 4. Автоматический запуск музыки
**Проблема**: `MusicManager` автоматически запускал музыку при разблокировке аудио контекста.

**Решение**:
- Убран автоматический запуск музыки из `start_audio_context()`
- Музыка запускается явно в `_start_game()` только когда игра начинается

## Соответствие требованиям платформы

### Пункт 1.19.1 ✅
SDK инициализируется строго согласно документации в `_initialize_yandex_sdk_async()`

### Пункт 1.19.2 ✅
GameReady API вызывается в момент, когда пользователь готов играть (в `_start_game()`)

### Пункт 1.19.3 ✅
GameplayAPI.start() и GameplayAPI.stop() используются корректно в `_start_game()` и `_set_game_over()`

### Пункт 1.19.4 ✅
Добавлена обработка событий `game_api_pause` и `game_api_resume` через JavaScript обработчики

## Файлы, которые были изменены

1. `autoloads/AudioUnlocker.gd` - добавлена проверка области клика
2. `scripts/Game.gd` - перенесен вызов GameReady API и добавлен запуск музыки
3. `singletons/MusicManager.gd` - убран автоматический запуск музыки
4. `addons/godot-yandex-games-sdk-main/yandex_sdk.gd` - добавлена обработка паузы/возобновления
5. `addons/godot-yandex-games-sdk-main/yandex_sdk.js` - добавлены JavaScript обработчики

## Тестирование

Для проверки исправлений:

1. Запустите игру в браузере
2. Кликните по черному экрану - музыка НЕ должна запуститься
3. Кликните по игровой области - музыка должна запуститься
4. Проверьте консоль браузера на наличие сообщений о GameReady API
5. Убедитесь, что GameReady API вызывается только при начале игры
