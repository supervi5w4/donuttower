# Исправления для соответствия требованиям платформы Яндекс.Игры

## Исправленные проблемы

### 1. Переключение языка в главном меню

**Решение**: Переключение языка доступно в главном меню как было изначально.

**Изменения**:
- `scripts/StartMenu.gd` - восстановлена функциональность переключения языка в главном меню

### 2. Воспроизведение звука при сворачивании страницы (п. 1.3)

**Проблема**: Звук продолжал воспроизводиться при сворачивании страницы браузера.

**Решение**:
- Добавлена обработка события `visibility_changed` в `YandexSDK`
- Добавлена обработка видимости в `MusicManager`
- При потере видимости страницы звук полностью отключается

**Изменения**:
- `addons/godot-yandex-games-sdk-main/yandex_sdk.gd` - добавлен обработчик `_on_visibility_changed()`
- `singletons/MusicManager.gd` - добавлена обработка видимости страницы

### 3. Воспроизведение звука при переключении вкладок (п. 1.3)

**Проблема**: Звук продолжал воспроизводиться при переключении на другую вкладку.

**Решение**:
- Используется тот же механизм обработки `visibility_changed`
- При переключении вкладки музыка останавливается
- При возвращении к вкладке настройки звука восстанавливаются

## Соответствие требованиям платформы

### Пункт 1.3 ✅
- Звук отключается при сворачивании страницы
- Звук отключается при переключении вкладок
- Звук восстанавливается при возвращении к игре

## Технические детали

### Обработка видимости страницы
```gdscript
func _on_visibility_changed() -> void:
    if not get_window().visible:
        # Отключаем звук при потере видимости
        AudioServer.set_bus_mute(0, true)
        if Music:
            Music.stop_bgm()
    else:
        # Восстанавливаем звук при возвращении видимости
        _update_mute()
```


## Тестирование

Для проверки исправлений:

1. **Тест переключения языка**:
   - В главном меню кнопка языка должна работать как обычно
   - Переключение языка доступно в главном меню

2. **Тест звука при сворачивании**:
   - Запустите игру с музыкой
   - Сверните окно браузера - музыка должна остановиться
   - Разверните окно - музыка должна возобновиться

3. **Тест звука при переключении вкладок**:
   - Запустите игру с музыкой
   - Переключитесь на другую вкладку - музыка должна остановиться
   - Вернитесь к игре - музыка должна возобновиться

## Файлы, которые были изменены

1. `scripts/StartMenu.gd` - восстановлена функциональность переключения языка в главном меню
2. `ui/GameOverPanel.gd` - убрана кнопка переключения языка (оставлена только в главном меню)
3. `addons/godot-yandex-games-sdk-main/yandex_sdk.gd` - добавлена обработка видимости страницы
4. `singletons/MusicManager.gd` - добавлена обработка видимости для музыки
