# Интеграция таблицы результатов (Лидерборд) в DonutTower

## Что было добавлено

### 1. Расширение YandexSDK
- **Файл**: `scripts/YandexSDK.gd` - добавлены функции для работы с лидербордами
- **Новые функции**:
  - `submit_score(score: int)` - отправляет результат игрока в лидерборд
  - `load_leaderboard()` - загружает топ-10 результатов
- **Новые сигналы**:
  - `leaderboard_loaded(entries: Array)` - лидерборд успешно загружен
  - `leaderboard_error(error_message: String)` - ошибка загрузки лидерборда
  - `score_submitted()` - результат успешно отправлен
  - `score_submit_error(error_message: String)` - ошибка отправки результата

### 2. Панель лидерборда
- **Файл**: `scripts/LeaderboardPanel.gd` - новый скрипт для отображения таблицы результатов
- **Функции**:
  - Автоматическая загрузка данных при инициализации
  - Отображение топ-10 игроков с рангами, именами и очками
  - Специальная стилизация для топ-3 (золото, серебро, бронза)
  - Обработка состояний загрузки и ошибок

### 3. Интеграция в игровую логику
- **Файл**: `scripts/Game.gd` - добавлена интеграция с лидербордом
- **Функции**:
  - `_submit_score_to_leaderboard()` - отправляет результат при Game Over
  - `_load_and_show_leaderboard()` - загружает и показывает лидерборд
  - Обработчики сигналов от YandexSDK

### 4. Обновление UI
- **Файл**: `scenes/Game.tscn` - добавлена LeaderboardPanel в GameOverPanel
- **Элементы**:
  - Заголовок "Лучшие результаты"
  - Контейнер для отображения списка игроков
  - Состояния загрузки и ошибок
  - Полупрозрачный фон для лучшей читаемости

## Как это работает

### При завершении игры:
1. Игра отправляет результат игрока в лидерборд Яндекс Игр
2. Автоматически загружается топ-10 результатов
3. В GameOverPanel отображается таблица с лучшими игроками
4. Показывается Interstitial реклама

### Стилизация:
- **Топ-1**: золотой цвет ранга
- **Топ-2**: серебряный цвет ранга  
- **Топ-3**: бронзовый цвет ранга
- **Остальные**: стандартный оранжевый цвет
- Все тексты имеют тени для лучшей читаемости
- Полупрозрачный фон для контраста

## Настройка лидерборда в Яндекс Играх

### 1. Создание лидерборда в Консоли разработчика:
- Перейдите в [Консоль разработчика Яндекс Игр](https://yandex.ru/dev/games/doc/ru/concepts/leaderboards)
- Выберите вашу игру и откройте вкладку "Лидерборды"
- Нажмите "Добавить лидерборд" и заполните:
  - **Техническое название**: `donuttowerleaderboard`
  - **Отображаемое название**: "Лучшие результаты"
  - **Тип лидерборда**: `numeric`
  - **Направление сортировки**: по убыванию (больше очков = выше место)

### 2. Авторизация пользователей:
Для корректного отображения имен игроков необходимо добавить авторизацию в HTML шаблон:

```javascript
// В yandex_games_template.html
ysdk.auth.openAuthDialog().then(() => {
    console.log('Пользователь авторизован');
}).catch((err) => {
    console.log('Ошибка авторизации', err);
});
```

## Технические детали

### Структура данных лидерборда:
```javascript
{
    "player": {
        "publicName": "Имя игрока",
        "name": "внутреннее_имя"
    },
    "score": 42
}
```

### Обработка ошибок:
- При недоступности SDK лидерборд не отображается
- При ошибках загрузки показывается сообщение об ошибке
- При ошибках отправки результата игра продолжается без проблем

### Совместимость:
- Работает только на веб-платформе (HTML5)
- Совместимо с Godot 4.4.1
- Использует JavaScriptBridge для взаимодействия с SDK

## Файлы проекта

### Новые файлы:
- `scripts/LeaderboardPanel.gd` - скрипт панели лидерборда
- `LEADERBOARD_INTEGRATION_README.md` - эта документация

### Измененные файлы:
- `scripts/YandexSDK.gd` - добавлены функции лидерборда
- `scripts/Game.gd` - добавлена интеграция с лидербордом
- `scenes/Game.tscn` - добавлена LeaderboardPanel в UI

## Требования Яндекс Игр

✅ **Лидерборд**: отображение топ-10 игроков  
✅ **Отправка результатов**: автоматическая отправка при Game Over  
✅ **Стилизация**: соответствует дизайну игры  
✅ **Обработка ошибок**: корректная обработка недоступности лидерборда  
✅ **Пользовательский опыт**: четкое отображение результатов с рангами

## Тестирование

### В редакторе Godot:
- Лидерборд не загружается (не веб-платформа)
- Показывается сообщение об ошибке загрузки
- Игра работает без проблем

### При экспорте в HTML5:
- Лидерборд загружается с Яндекс Игр
- Результаты отправляются автоматически
- Отображается таблица с лучшими игроками
- В консоли браузера видны логи работы с SDK
