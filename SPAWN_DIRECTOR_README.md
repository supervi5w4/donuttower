# SpawnDirector - Система динамической подкрутки спавна пончиков

## Описание

SpawnDirector реализует "липкую" Марковскую модель для создания более предсказуемых паттернов спавна пончиков на ранних уровнях игры. Чем ниже уровень, тем чаще подряд выпадает один и тот же тип пончика.

## Особенности

- **Детерминируемость**: При одинаковом seed результаты воспроизводимы
- **Уровневая конфигурация**: Настройки для каждого из первых 5 уровней
- **Ограничитель серий**: Максимальная длина серии одинаковых пончиков
- **Кулдаун система**: Временное снижение "липкости" после достижения лимита
- **Телеметрия**: Полное логирование всех решений системы

## Конфигурация уровней

```gdscript
var LEVEL_CONFIG := {
    1: { "stickiness": 0.65, "streak_cap": 3, "cooldown_factor": 0.6, "cooldown_spawns": 3 },
    2: { "stickiness": 0.58, "streak_cap": 3, "cooldown_factor": 0.65, "cooldown_spawns": 3 },
    3: { "stickiness": 0.48, "streak_cap": 3, "cooldown_factor": 0.7,  "cooldown_spawns": 3 },
    4: { "stickiness": 0.35, "streak_cap": 3, "cooldown_factor": 0.75, "cooldown_spawns": 2 },
    5: { "stickiness": 0.25, "streak_cap": 3, "cooldown_factor": 0.8,  "cooldown_spawns": 2 }
}
```

### Динамическая формула для уровней выше 5

Для уровней выше 5-го используется динамическое вычисление:
```gdscript
stickiness = clamp(0.65 - 0.10 * (level - 1), 0.25, 0.65)
```

### Параметры

- **stickiness** (0.0-1.0): Вероятность повторить прошлый тип пончика
- **streak_cap**: Максимальная длина серии одинаковых пончиков
- **cooldown_factor**: Множитель для временного снижения stickiness
- **cooldown_spawns**: Количество спавнов с пониженной stickiness

## API

### Основные методы

```gdscript
# Инициализация с seed
SpawnDirector.init_seed(seed: int = 0)

# Сброс состояния для уровня
SpawnDirector.reset(level: int)

# Получение следующего типа пончика
var donut_type: String = SpawnDirector.get_next_donut_type(level: int)

# Получение текстуры по типу
var texture: Texture2D = SpawnDirector.get_next_donut_texture(type: String)

# Просмотр следующего типа без влияния на состояние
var peek_type: String = SpawnDirector.peek_next(level: int)

# Экспорт телеметрии в CSV
SpawnDirector.export_csv(path: String)

# Установка кастомной конфигурации
SpawnDirector.set_custom_config(level: int, cfg: Dictionary)
```

## Тестирование

В игре нажмите клавишу **T** для запуска тестового режима:
- Генерирует 20 пончиков и выводит результаты в консоль
- Сохраняет телеметрию в `user://spawn_test.csv`

## Интеграция

Система автоматически интегрирована в `Game.gd`:
- Инициализируется при старте уровня
- Заменяет случайный выбор пончиков на управляемый
- Обновляет превью следующего пончика

## Телеметрия

Каждое решение системы логируется с информацией:
- Тип события (first, normal, force_switch, reset)
- Уровень игры
- Выбранный тип пончика
- Эффективная stickiness
- Статус кулдауна
- Текущая длина серии

## Дизайн-принципы

- **Ранние уровни**: Высокая stickiness создает предсказуемые паттерны
- **Поздние уровни**: Низкая stickiness увеличивает разнообразие
- **Защита от залипания**: Ограничитель серий предотвращает раздражение игрока
- **Воспроизводимость**: Seed обеспечивает отладку и A/B тестирование
